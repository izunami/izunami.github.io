<!DOCTYPE html>
<html lang="vi" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Nguy·ªÖn Thu·∫≠n ‚Ä¢ Portfolio</title>
  <meta name="description" content="Portfolio c·ªßa Nguy·ªÖn Thu·∫≠n: WordPress, Blogspot, Corel. X√¢y web nhanh, g·ªçn, d·ªÖ b·∫£o tr√¨." />
  <link rel="canonical" href="https://izunami.github.io/" />
  <meta name="color-scheme" content="light dark">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f6f7fb">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0f1216">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Nguy·ªÖn Thu·∫≠n ‚Ä¢ Portfolio">
  <meta property="og:description" content="WordPress ‚Ä¢ Blogspot ‚Ä¢ Corel. Web nhanh, g·ªçn, d·ªÖ b·∫£o tr√¨.">
  <meta property="og:image" content="avatar.jpg">
  <meta property="og:locale" content="vi_VN">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Nguy·ªÖn Thu·∫≠n ‚Ä¢ Portfolio">
  <meta name="twitter:description" content="WordPress ‚Ä¢ Blogspot ‚Ä¢ Corel. Web nhanh, g·ªçn, d·ªÖ b·∫£o tr√¨.">
  <meta name="twitter:image" content="avatar.jpg">
  <link rel="preload" as="image" href="avatar.jpg" imagesrcset="avatar.jpg 1x" imagesizes="72px">

  <style>
    :root{
      --bg: #f6f7fb; --card:#fff; --text:#1f2430; --muted:#5e6a7a; --brand:#6c63ff;
      --shadow: 0 10px 30px rgba(0,0,0,.06); --border: rgba(0,0,0,.06);
      --focus: 0 0 0 3px rgba(108,99,255,.35);
    }
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0f1216; --card:#151a21; --text:#e8ecf2; --muted:#9aa6b2; --brand:#7b7eff;
        --shadow:0 10px 30px rgba(0,0,0,.35); --border:rgba(255,255,255,.06);
        --focus:0 0 0 3px rgba(123,126,255,.35);
      }
    }
    html[data-theme="light"]{ --bg:#f6f7fb; --card:#fff; --text:#1f2430; --muted:#5e6a7a; --brand:#6c63ff; --shadow:0 10px 30px rgba(0,0,0,.06); --border:rgba(0,0,0,.06); --focus:0 0 0 3px rgba(108,99,255,.35);}
    html[data-theme="dark"] { --bg:#0f1216; --card:#151a21; --text:#e8ecf2; --muted:#9aa6b2; --brand:#7b7eff; --shadow:0 10px 30px rgba(0,0,0,.35); --border:rgba(255,255,255,.06); --focus:0 0 0 3px rgba(123,126,255,.35);}

    *{box-sizing:border-box}
    body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      background:var(--bg); color:var(--text); line-height:1.65; text-rendering:optimizeLegibility; -webkit-font-smoothing:antialiased;}
    a{color:inherit}
    a:focus-visible,button:focus-visible{outline:none; box-shadow:var(--focus); border-radius:10px;}

    .container{max-width:980px; margin:0 auto; padding:24px}
    header.site{
      display:flex; align-items:center; gap:20px; padding:24px; border-radius:16px; background:var(--card);
      box-shadow:var(--shadow); border:1px solid var(--border); position:sticky; top:16px; z-index:10; backdrop-filter:saturate(140%) blur(6px);
    }
    .avatar{width:72px; height:72px; border-radius:50%; border:3px solid var(--border); object-fit:cover;}
    .headings{flex:1; min-width:0;}
    h1{margin:0 0 6px; font-size:clamp(22px, 2.4vw + 14px, 32px);}
    .sub{margin:0; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis;}

    /* ===== Floating theme FAB ===== */
    .theme-fab{
      position: fixed; right: 16px; bottom: 16px;
      width: 48px; height: 48px; border-radius: 999px;
      background: var(--card); color: var(--text);
      border: 1px solid var(--border); box-shadow: var(--shadow);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; z-index: 9999; user-select: none;
      transition: transform .18s ease, box-shadow .18s ease, background .18s ease;
    }
    .theme-fab:hover { transform: translateY(-2px); box-shadow: 0 12px 26px rgba(0,0,0,.16); }
    .theme-fab:active{ transform: translateY(0); box-shadow: 0 6px 16px rgba(0,0,0,.12); }
    .theme-fab .icon{ font-size: 20px; line-height: 1; }
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    @media (max-width:600px){
      header.site{ display:grid; grid-template-columns:72px 1fr; gap:14px 16px; align-items:center; }
      .avatar{ grid-column:1; grid-row:1; }
      .headings{ grid-column:2; grid-row:1; }
      .theme-fab{ right: 12px; bottom: 12px; width: 44px; height: 44px; }
    }

    main{margin-top:24px; display:grid; gap:24px}
    .card{ background:var(--card); border:1px solid var(--border); border-radius:16px; padding:24px; box-shadow:var(--shadow);
      opacity:0; transform:translateY(12px); animation:fadeUp .7s ease forwards; }
    .card:nth-child(1){animation-delay:.05s} .card:nth-child(2){animation-delay:.15s}
    .card:nth-child(3){animation-delay:.25s} .card:nth-child(4){animation-delay:.35s}
    @keyframes fadeUp{to{opacity:1; transform:none}}

    h2{margin-top:0; font-size:1.25rem; display:flex; align-items:center; gap:10px}
    h2 .dot{width:10px; height:10px; border-radius:50%; background:var(--brand); box-shadow:0 0 12px var(--brand)}
    p, li{color:var(--text)} .muted{color:var(--muted)}

    .grid{ display:grid; gap:16px; grid-template-columns:repeat(auto-fill, minmax(220px,1fr)); }
    .project{border:1px solid var(--border); border-radius:12px; padding:16px}
    .project h3{margin:0 0 8px; font-size:1.05rem}
    .project a{color:var(--brand); text-decoration:none}
    .project a:hover{text-decoration:underline}

    .typewriter{ display:inline-block; border-right:2px solid var(--brand); white-space:nowrap; overflow:hidden; animation:caret 900ms steps(1,end) infinite; }
    @keyframes caret{50%{border-right-color:transparent}}

    footer{color:var(--muted); text-align:center; padding:24px}
    .reveal{opacity:0; transform:translateY(16px)}
    .reveal.is-visible{opacity:1; transform:none; transition:opacity .6s ease, transform .6s ease}
    a.link{color:var(--brand)} code{background:rgba(127,127,127,.12); padding:.1em .35em; border-radius:.4em}

    @media (prefers-reduced-motion: reduce) {
      .card, .reveal { animation: none !important; opacity: 1 !important; transform: none !important; }
      .typewriter { animation: none !important; border-right: none; }
      .theme-fab{ transition:none }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="site">
      <img class="avatar" src="https://raw.githubusercontent.com/izunami/izunami.github.io/refs/heads/main/avatar.jpg" width="72" height="72" fetchpriority="high" alt="·∫¢nh ƒë·∫°i di·ªán Nguy·ªÖn Thu·∫≠n">
      <div class="headings">
        <h1>Nguy·ªÖn Thu·∫≠n üçÄ</h1>
        <p class="sub"><span class="typewriter" id="tw"></span></p>
      </div>
    </header>

    <main>
      <section class="card reveal">
        <h2><span class="dot"></span>Gi·ªõi thi·ªáu</h2>
        <p>Xin ch√†o! M√¨nh l√† Thu·∫≠n ‚Äì ƒëam m√™ c√¥ng ngh·ªá, DIY ph·∫ßn c·ª©ng v√† nhi·∫øp ·∫£nh. M·ª•c ti√™u: t·∫°o ra s·∫£n ph·∫©m web nhanh, g·ªçn, d·ªÖ b·∫£o tr√¨.</p>
        <p class="muted">Stack ∆∞a th√≠ch: <strong>WordPress</strong>, <strong>Blogspot</strong>, <strong>Arduino</strong>.</p>
      </section>

      <section class="card reveal">
        <h2><span class="dot"></span>K·ªπ nƒÉng ch√≠nh</h2>
        <ul><li>WordPress</li><li>Blogspot</li><li>Corel</li></ul>
      </section>

      <section class="card reveal">
        <h2><span class="dot"></span>D·ª± √°n n·ªïi b·∫≠t</h2>
        <div class="grid">
          <article class="project"><h3>Portfolio v1</h3><p>Trang gi·ªõi thi·ªáu c√° nh√¢n t·ªëi gi·∫£n</p><a href="#">Xem chi ti·∫øt ‚Üí</a></article>
          <article class="project"><h3>Blog Tech</h3><p>Chia s·∫ª tips WordPress</p><a href="#">Xem blog ‚Üí</a></article>
          <article class="project"><h3>Website</h3><p>M·ªôt s·ªë website build b·∫±ng WP</p><a href="#">Xem demo ‚Üí</a></article>
        </div>
      </section>

      <section id="contact" class="card reveal">
        <h2><span class="dot"></span>Li√™n h·ªá</h2>
        <p>Zalo: <a class="link" href="https://zalo.me/0398427843" rel="me">Zalo Me</a></p>
        <p>Email: <a class="link" href="mailto:info@vnbit.io.vn" rel="me">info@vnbit.io.vn</a></p>
        <p>GitHub: <a class="link" href="https://github.com/izunami" target="_blank">github.com/izunami</a></p>
        <p>LinkedIn: <a class="link" href="https://www.linkedin.com/in/nguyenthuan0109/" target="_blank">linkedin.com/in/nguyenthuan0109</a></p>
      </section>
    </main>

    <footer>¬© <span id="year"></span> Nguy·ªÖn Thu·∫≠n üçÄ ‚Ä¢ Made with ‚ù§Ô∏è</footer>
  </div>

  <!-- Floating theme button -->
  <button id="themeFab" class="theme-fab" aria-pressed="false" title="Ch·∫°m ƒë·ªÉ ƒë·ªïi Light/Dark ‚Ä¢ Nh·∫•n gi·ªØ ƒë·ªÉ Auto">
    <span id="fabIcon" class="icon" aria-hidden="true">‚òÄÔ∏è</span>
    <span class="sr-only" id="fabLabel">ƒê·ªïi giao di·ªán</span>
  </button>

  <script>
    // Typewriter
    (function(){
      const el = document.getElementById('tw');
      const roles = ["Web Developer","WordPress (Static/Headless)","Arduino & IoT tinkerer","Coffee Lover ‚òï"];
      const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
      if (reduce) { el.textContent = roles[0]; return; }
      let idx=0,i=0,typing=true,pause=1200;
      function tick(){
        const full = roles[idx];
        if(typing){ i++; el.textContent = full.slice(0,i); if(i===full.length){ typing=false; return setTimeout(tick,pause);} }
        else { i--; el.textContent = full.slice(0,i); if(i===0){ typing=true; idx=(idx+1)%roles.length; } }
        setTimeout(tick, typing?60:35);
      } tick();
    })();

    // Fade-in
    (function(){
      const reduce = matchMedia('(prefers-reduced-motion: reduce)').matches;
      const items = document.querySelectorAll('.reveal');
      if (reduce) { items.forEach(el=>el.classList.add('is-visible')); return; }
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('is-visible'); io.unobserve(e.target);} });
      }, {threshold:.12});
      items.forEach(i=>io.observe(i));
    })();

    // Year
    document.getElementById('year').textContent = new Date().getFullYear();

    // Theme
    (function(){
      const root = document.documentElement;
      const fab  = document.getElementById('themeFab');
      const icon = document.getElementById('fabIcon');
      const KEY  = 'theme-pref'; // 'auto' | 'light' | 'dark'
      const mq   = matchMedia('(prefers-color-scheme: dark)');

      function setIcon(mode){
        const effectiveDark = mode==='dark' || (mode==='auto' && mq.matches);
        icon.textContent = effectiveDark ? 'üåô' : '‚òÄÔ∏è';
      }
      function apply(mode){
        root.setAttribute('data-theme', mode);
        fab.setAttribute('aria-pressed', mode!=='auto');
        setIcon(mode);
      }

      // Default = light
      const start = localStorage.getItem(KEY) || 'light';
      apply(start);

      mq.addEventListener('change', ()=> {
        if ((localStorage.getItem(KEY) || 'light') === 'auto') apply('auto');
      });

      fab.addEventListener('click', ()=> {
        const cur = localStorage.getItem(KEY) || 'light';
        const next = cur === 'dark' ? 'light' : 'dark';
        localStorage.setItem(KEY, next);
        apply(next);
      }, {passive:true});

      // Long-press ~600ms = Auto
      let pressTimer;
      fab.addEventListener('mousedown', ()=> { pressTimer = setTimeout(()=> {
        localStorage.setItem(KEY, 'auto'); apply('auto');
      }, 600); });
      ['mouseup','mouseleave','touchend','touchcancel'].forEach(ev=>fab.addEventListener(ev, ()=>clearTimeout(pressTimer)));
      fab.addEventListener('touchstart', ()=> { pressTimer = setTimeout(()=> {
        localStorage.setItem(KEY, 'auto'); apply('auto');
      }, 600); }, {passive:true});
    })();
  </script>
</body>
</html>


<!-- üêæ Doro Runner (high-FPS + fixed timestep + readable bubble + responsive size) -->
<style>
  #doro {
    position: fixed; left: 40px; top: 40px;
    width: 96px; height: 96px;
    pointer-events: auto; user-select: none;
    z-index: 9999;
    filter: drop-shadow(0 6px 10px rgba(0,0,0,.25));
    transform: translate3d(0,0,0);
    will-change: transform;
  }

  /* Bubble chat + tail */
  #doro-bubble {
    position: fixed;
    max-width: 300px;
    background: rgba(255,255,255,.92);
    color: #111;
    font-size: 15px;
    padding: 10px 14px;
    border-radius: 12px;
    box-shadow: 0 8px 22px rgba(0,0,0,.28);
    line-height: 1.55;
    z-index: 10000;
    opacity: 0;
    pointer-events: none;
    transition: opacity .18s ease, transform .18s ease;
    white-space: normal;
    transform: translate3d(0,0,0);
    backdrop-filter: saturate(120%) blur(4px);
    text-shadow: 0 1px 0 rgba(255,255,255,.35);
  }
  html[data-theme="dark"] #doro-bubble {
    background: rgba(34,34,34,.92);
    color: #eee;
    text-shadow: 0 1px 0 rgba(0,0,0,.35);
  }
  #doro-bubble.show { opacity: 1; }

  #doro-bubble::after {
    content: ""; position: absolute; width: 0; height: 0;
    border: 8px solid transparent;
  }
  #doro-bubble.tail-top::after    { top: -16px;    left: 20px; border-bottom-color: #fff; }
  #doro-bubble.tail-bottom::after { bottom: -16px; left: 20px; border-top-color:    #fff; }
  #doro-bubble.tail-left::after   { right: -16px;  top: 12px;  border-left-color:  #fff; }
  #doro-bubble.tail-right::after  { left: -16px;   top: 12px;  border-right-color: #fff; }
  html[data-theme="dark"] #doro-bubble.tail-top::after    { border-bottom-color:#222; }
  html[data-theme="dark"] #doro-bubble.tail-bottom::after { border-top-color:#222; }
  html[data-theme="dark"] #doro-bubble.tail-left::after   { border-left-color:#222; }
  html[data-theme="dark"] #doro-bubble.tail-right::after  { border-right-color:#222; }

  @media (prefers-reduced-motion: reduce) {
    #doro { display:none !important; }
  }
</style>

<img id="doro" src="doro.gif" alt="pet gif" aria-hidden="true">
<div id="doro-bubble" role="status" aria-live="polite"></div>

<script>
(() => {
  // ===== Config =====
  const GIF_SRC = 'doro.gif';       // ƒë·ªïi t√™n n·∫øu kh√°c
  const BASE_SIZE = 96;             // PC size
  const MOBILE_SIZE = 64;           // Mobile size
  let SIZE = BASE_SIZE;

  const BASE_SPEED = 0.18;
  const NOISE = 0.00030;
  const MAX_SPEED = 0.38;
  const EDGE_PADDING = 8;
  const REPEL_RADIUS = 150;
  const REPEL_FORCE = 0.03;
  const HOVER_BOOST = 1.03;
  const HOVER_DURATION = 340;

  const STEP_MS = 8;                
  const MAX_CATCHUP_STEPS = 8;      

  const TALK_SPEED_SCALE = 0.30;    
  const TALK_MAX_SCALE   = 0.45;    

  const BUBBLE_MS = 2500;           
  const HOVER_INTERVAL = 2500;      
  const TAIL_COUNT = 2;             
  const BUBBLE_OFFSET = 12;         

  const DEFAULT_FACE = 'left';      
  const FACE_DEADZONE = 0.10;

  const el = document.getElementById('doro');
  const bubble = document.getElementById('doro-bubble');
  el.src = GIF_SRC;

  // Responsive size
  function updateSize() {
    if (window.innerWidth <= 768) {
      SIZE = MOBILE_SIZE;
    } else {
      SIZE = BASE_SIZE;
    }
    el.width = el.height = SIZE;
  }
  updateSize();
  addEventListener('resize', updateSize);

  // ===== Tho·∫°i =====
  const lines = {
    cute: [
      "Nyaa~ b·∫Øt ƒë∆∞·ª£c Doro ch∆∞a n√†o?",
      "Mou~ ƒë·ª´ng d√≠ n·ªØa m√†~",
      "B·∫Øt Doro ƒëi, n·∫øu d√°m ƒë√≥!",
      "Doro ch·∫°y nhanh nh∆∞ gi√≥ n√®~",
      "A‚Ä¶ sugoi! Doro n√© ƒë∆∞·ª£c r·ªìi!"
    ],
    cool: [
      "T·ªëc ƒë·ªô ch√≠nh l√† s·ª©c m·∫°nh c·ªßa ta!",
      "N·∫øu mu·ªën ƒëu·ªïi theo‚Ä¶ h√£y c·ªë h∆°n ƒëi!",
      "M·ªôt khi Doro ƒë√£ ch·∫°y‚Ä¶ kh√¥ng g√¨ c·∫£n n·ªïi!",
      "ƒê√¢y‚Ä¶ m·ªõi l√† t·ªëc ƒë·ªô th·∫≠t s·ª±!",
      "Ta kh√¥ng ch·∫°y tr·ªën‚Ä¶ ch·ªâ ƒëang ti·∫øn l√™n ph√≠a tr∆∞·ªõc!"
    ],
    troll: [
      "Th√¥i th√¥i, ƒë·ª´ng d√≠ n·ªØa‚Ä¶ Doro c√≤n non n∆∞·ªõc l·∫Øm!",
      "Ch·∫°y ri·∫øt r·ªìi s·∫Øp h·∫øt stamina r·ªìi ƒë√≥ nha~",
      "·ª¶a d√≠ chi, c√≥ th∆∞·ªüng h·∫£?",
      "ƒê·ª©ng l·∫°i ƒëi! ‚Ä¶√Ä nh·∫ßm, th√¥i ƒë·ªÉ Doro ch·∫°y ti·∫øp üòè",
      "Ai cho tui ly tr√† s·ªØa v·ªõi, ch·∫°y x·ªâu lu√¥n r·ªìi! üßã"
    ]
  };
  const groups = Object.keys(lines);
  let lastLine = "";
  function randomLine() {
    const g = groups[Math.floor(Math.random()*groups.length)];
    const arr = lines[g];
    let pick = arr[Math.floor(Math.random()*arr.length)];
    if (arr.length > 1) {
      let safe = 6;
      while (pick === lastLine && safe-- > 0) pick = arr[Math.floor(Math.random()*arr.length)];
    }
    lastLine = pick;
    return pick;
  }

  // ===== State di chuy·ªÉn =====
  let x = 40, y = 40;
  let vx = (Math.random()*2-1) * BASE_SPEED;
  let vy = (Math.random()*2-1) * BASE_SPEED;

  el.style.transform = `translate3d(${x}px, ${y}px, 0) scaleX(${DEFAULT_FACE==='left' ? 1 : -1})`;

  let mouse = { x: -9999, y: -9999 };
  let hoverBoostUntil = 0;

  const scaleWhenFacingRight = (DEFAULT_FACE === 'right') ? 1 : -1;
  const scaleWhenFacingLeft  = -scaleWhenFacingRight;

  let bubbleHideTo = null;
  let hoverInterval = null;
  let tailTimeouts = [];

  function clearTail(){ tailTimeouts.forEach(t=>clearTimeout(t)); tailTimeouts = []; }
  function isBubbleVisible(){ return bubble.classList.contains('show'); }

  function placeBubble() {
    const rect = el.getBoundingClientRect();
    const bw = Math.max(bubble.offsetWidth || 240, 180);
    const bh = Math.max(bubble.offsetHeight || 60, 40);
    const centerX = rect.left + rect.width/2;
    const headTop = rect.top;
    const headBot = rect.bottom;
    const facingRight = getComputedStyle(el).transform.includes('matrix(-1') ? false : true;

    const candidates = [
      { x: centerX + (facingRight ? rect.width*0.25 : -rect.width*0.25),
        y: headTop - BUBBLE_OFFSET - bh, tail: 'tail-bottom' },
      { x: centerX + (facingRight ? rect.width*0.25 : -rect.width*0.25),
        y: headBot + BUBBLE_OFFSET, tail: 'tail-top' },
      { x: rect.left - BUBBLE_OFFSET - bw, y: headTop + rect.height*0.15, tail: 'tail-right' },
      { x: rect.right + BUBBLE_OFFSET, y: headTop + rect.height*0.15, tail: 'tail-left' }
    ];

    let pick = null;
    for (const c of candidates) {
      const okX = c.x >= 8 && c.x + bw <= innerWidth - 8;
      const okY = c.y >= 8 && c.y + bh <= innerHeight - 8;
      if (okX && okY) { pick = c; break; }
    }
    if (!pick) {
      pick = candidates[0];
      pick.x = Math.min(Math.max(8, pick.x), innerWidth - bw - 8);
      pick.y = Math.min(Math.max(8, pick.y), innerHeight - bh - 8);
    }

    bubble.style.left = pick.x + 'px';
    bubble.style.top  = pick.y + 'px';
    bubble.classList.remove('tail-top','tail-bottom','tail-left','tail-right');
    bubble.classList.add(pick.tail);
  }

  function showBubble(text = randomLine()) {
    bubble.textContent = text;
    placeBubble();
    bubble.classList.add('show');
    if (bubbleHideTo) clearTimeout(bubbleHideTo);
    bubbleHideTo = setTimeout(()=> {
      bubble.classList.remove('show');
      bubbleHideTo = null;
    }, BUBBLE_MS);
  }

  // ===== Events =====
  addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; }, {passive:true});
  addEventListener('mouseleave', () => { mouse.x = -9999; mouse.y = -9999; }, {passive:true});
  addEventListener('touchmove', e => { const t=e.touches[0]; if(t){ mouse.x=t.clientX; mouse.y=t.clientY; }}, {passive:true});
  el.addEventListener('dragstart', e => e.preventDefault());

  el.addEventListener('mouseenter', () => {
    hoverBoostUntil = performance.now() + HOVER_DURATION;
    clearInterval(hoverInterval);
    clearTail();
    showBubble();
    hoverInterval = setInterval(showBubble, HOVER_INTERVAL);
  });

  el.addEventListener('mouseleave', () => {
    clearInterval(hoverInterval);
    hoverInterval = null;
    clearTail();
    for (let i = 1; i <= TAIL_COUNT; i++) {
      tailTimeouts.push(setTimeout(() => showBubble(), i * BUBBLE_MS));
    }
  });

  // ===== Loop =====
  let prev = performance.now();
  let accumulator = 0;

  function physicsStep(step) {
    const talking = isBubbleVisible();
    const speedScale = talking ? TALK_SPEED_SCALE : 1;
    const maxScale   = talking ? TALK_MAX_SCALE   : 1;

    vx += (Math.random()-0.5) * NOISE * step * speedScale;
    vy += (Math.random()-0.5) * NOISE * step * speedScale;

    const cx = x + SIZE/2, cy = y + SIZE/2;
    const dx = cx - mouse.x, dy = cy - mouse.y;
    const dist = Math.hypot(dx,dy);
    if (dist < REPEL_RADIUS){
      const f = (1 - dist/REPEL_RADIUS) * REPEL_FORCE * speedScale;
      const inv = dist || 1;
      vx += (dx/inv) * f * step;
      vy += (dy/inv) * f * step;
    }

    if (performance.now() < hoverBoostUntil){
      const inv = Math.hypot(dx,dy) || 1;
      vx += (dx/inv) * HOVER_BOOST * 0.006 * step * speedScale;
      vy += (dy/inv) * HOVER_BOOST * 0.006 * step * speedScale;
    }

    const invv = Math.hypot(vx,vy) || 1;
    vx += (vx/invv) * BASE_SPEED * 0.001 * step * speedScale;
    vy += (vy/invv) * BASE_SPEED * 0.001 * step * speedScale;

    const maxV = MAX_SPEED * maxScale;
    const sp = Math.hypot(vx,vy);
    if (sp > maxV){ vx = vx/sp*maxV; vy = vy/sp*maxV; }

    x += vx * step; y += vy * step;

    const vw = innerWidth, vh = innerHeight;
    if (x < EDGE_PADDING){ x = EDGE_PADDING; vx = Math.abs(vx); }
    if (y < EDGE_PADDING){ y = EDGE_PADDING; vy = Math.abs(vy); }
    if (x > vw - SIZE - EDGE_PADDING){ x = vw - SIZE - EDGE_PADDING; vx = -Math.abs(vx); }
    if (y > vh - SIZE - EDGE_PADDING){ y = vh - SIZE - EDGE_PADDING; vy = -Math.abs(vy); }

    const mtx = getComputedStyle(el).transform;
    let currentScaleX = mtx.includes('matrix(-1') ? -1 : 1;
    let targetScaleX = currentScaleX;
    if (vx >  FACE_DEADZONE) targetScaleX = (DEFAULT_FACE === 'right') ? 1 : -1;
    if (vx < -FACE_DEADZONE) targetScaleX = (DEFAULT_FACE === 'right') ? -1 : 1;

    el.style.transform = `translate3d(${x}px, ${y}px, 0) scaleX(${targetScaleX})`;

    if (talking) placeBubble();
  }

  function loop(now) {
    const dt = Math.min(40, now - prev);
    prev = now;
    accumulator += dt;
    let safety = 0;
    while (accumulator >= STEP_MS && safety++ < MAX_CATCHUP_STEPS) {
      physicsStep(STEP_MS);
      accumulator -= STEP_MS;
    }
    requestAnimationFrame(loop);
  }
  requestAnimationFrame(loop);

  addEventListener('resize', () => {
    x = Math.max(EDGE_PADDING, Math.min(x, innerWidth  - SIZE - EDGE_PADDING));
    y = Math.max(EDGE_PADDING, Math.min(y, innerHeight - SIZE - EDGE_PADDING));
  }, {passive:true});
})();
</script>  
</body>
</html>

















